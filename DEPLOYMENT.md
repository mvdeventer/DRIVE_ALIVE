# Render.com Deployment Guide - Drive Alive

## Prerequisites

- GitHub account
- Render.com account (free, no credit card required)
- Your code pushed to GitHub

---

## Step 1: Prepare Your Repository

### 1.1 Push to GitHub

```bash
git add .
git commit -m "Prepare for Render deployment"
git push origin main
```

### 1.2 Update Frontend Config

Make sure `frontend/config.ts` uses environment-based API URL:

```typescript
const API_URL =
  process.env.EXPO_PUBLIC_API_URL || "https://drive-alive-api.onrender.com";
```

---

## Step 2: Deploy to Render

### 2.1 Sign Up

1. Go to https://render.com
2. Click "Get Started for Free"
3. Sign up with GitHub

### 2.2 Connect Repository

1. Click "New +"
2. Select "Blueprint"
3. Connect your GitHub account
4. Select `mvdeventer/DRIVE_ALIVE` repository
5. Render will detect `render.yaml` automatically

### 2.3 Configure Services

Render will create:

- ✅ **drive-alive-api** (Backend - FastAPI)
- ✅ **drive-alive-web** (Frontend - React Native Web)
- ✅ **drive-alive-db** (PostgreSQL Database)

Click "Apply" to create all services.

---

## Step 3: Add Environment Variables

### 3.1 Backend Environment Variables

Go to `drive-alive-api` → Environment:

**Required:**

```
DATABASE_URL=<auto-generated from database>
SECRET_KEY=<auto-generated>
FRONTEND_URL=https://drive-alive-web.onrender.com
ALLOWED_ORIGINS=https://drive-alive-web.onrender.com
```

**Optional (Payment & WhatsApp):**

```
STRIPE_SECRET_KEY=sk_test_...
STRIPE_PUBLISHABLE_KEY=pk_test_...
PAYFAST_MERCHANT_ID=...
PAYFAST_MERCHANT_KEY=...
TWILIO_ACCOUNT_SID=...
TWILIO_AUTH_TOKEN=...
TWILIO_WHATSAPP_FROM=whatsapp:+...
```

### 3.2 Frontend Environment Variables

Go to `drive-alive-web` → Environment:

```
EXPO_PUBLIC_API_URL=https://drive-alive-api.onrender.com
```

---

## Step 4: Database Migration

### 4.1 Connect to PostgreSQL Shell

1. Go to `drive-alive-db` → Info
2. Copy connection string
3. Run migrations:

```bash
# Install psql locally or use Render shell
psql <connection-string>

# Or use Python migration script
python backend/migrations/create_tables.py
```

### 4.2 Initialize Database

Run your database initialization scripts:

```bash
# Create admin user
python backend/create_admin.py

# Generate test instructors (optional)
python backend/generate_instructors.py
```

---

## Step 5: Access Your App

### URLs:

- **Frontend:** https://drive-alive-web.onrender.com
- **Backend API:** https://drive-alive-api.onrender.com
- **API Docs:** https://drive-alive-api.onrender.com/docs

### First Time Login:

- Email: admin@drivealive.co.za
- Password: <your admin password>

---

## Step 6: Custom Domain (Optional)

### 6.1 Add Custom Domain

1. Go to `drive-alive-web` → Settings → Custom Domains
2. Add: `www.drivealive.co.za`
3. Update DNS records at your domain registrar:
   ```
   CNAME www drive-alive-web.onrender.com
   ```

### 6.2 Update Backend CORS

Update environment variable:

```
ALLOWED_ORIGINS=https://www.drivealive.co.za,https://drive-alive-web.onrender.com
```

---

## Troubleshooting

### Build Failures

**Frontend:**

```bash
# Check logs in Render dashboard
# Common issues:
# - Missing dependencies: npm install
# - Expo build errors: npx expo export:web --clear
```

**Backend:**

```bash
# Check logs in Render dashboard
# Common issues:
# - Missing packages: pip install -r requirements.txt
# - Database connection: Check DATABASE_URL
```

### Free Tier Limitations

**Important:**

- Services sleep after 15 min of inactivity
- First request after sleep takes ~30 seconds
- Upgrade to paid plan ($7/month) for always-on

**Workaround:**
Use cron job to ping API every 14 minutes:

```bash
# Use cron-job.org or similar
GET https://drive-alive-api.onrender.com/health
```

---

## Monitoring

### Health Checks

- Backend: https://drive-alive-api.onrender.com/health
- Frontend: Check in browser

### Logs

- Render Dashboard → Logs tab
- Real-time streaming
- Download for debugging

---

## Cost Breakdown

| Service   | Free Tier                   | Paid Plan            |
| --------- | --------------------------- | -------------------- |
| Backend   | ✅ Yes (sleeps after 15min) | $7/month (always-on) |
| Frontend  | ✅ Yes                      | Free                 |
| Database  | ✅ 90 days free             | $7/month             |
| **Total** | **$0 (3 months)**           | **$7-14/month**      |

---

## Next Steps

1. ✅ Deploy to Render
2. ✅ Test login and booking flow
3. ✅ Add payment credentials
4. ✅ Setup WhatsApp Business API
5. ✅ Configure custom domain
6. ✅ Monitor and optimize

---

## Support

- Render Docs: https://render.com/docs
- FastAPI Deployment: https://render.com/docs/deploy-fastapi
- Static Site: https://render.com/docs/static-sites

**Questions?** Check Render community forum or contact support@render.com
